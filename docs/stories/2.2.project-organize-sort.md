# Story 2.2: 项目组织与排序

## Status
Draft

## Story
**作为** 独立开发者，
**我希望** 能够对项目进行排序和组织，
**以便** 按照我的工作习惯安排项目。

## Acceptance Criteria
1. 支持项目卡片的横向拖拽排序
2. 记住用户的项目排序偏好
3. 支持项目的折叠和展开显示
4. 提供项目的快速搜索功能
5. 支持按项目状态筛选项目

## Tasks / Subtasks
- [ ] 实现项目拖拽排序功能 (AC: 1, 2)
  - [ ] 集成HTML5 Drag & Drop API到ProjectCard组件
  - [ ] 实现ProjectAPI.updateOrder()方法
  - [ ] 添加拖拽视觉反馈和拖拽占位符
  - [ ] 保存项目排序偏好到存储系统
  - [ ] 处理拖拽错误和边界情况
- [ ] 实现项目折叠展开功能 (AC: 3)
  - [ ] 在ProjectCard组件中添加折叠/展开状态管理
  - [ ] 实现任务列表的显示/隐藏切换
  - [ ] 保存项目折叠状态偏好
  - [ ] 添加折叠/展开动画过渡
  - [ ] 提供全部折叠/展开的批量操作
- [ ] 实现项目搜索功能 (AC: 4)
  - [ ] 创建搜索输入组件和搜索状态管理
  - [ ] 实现项目名称和描述的实时搜索过滤
  - [ ] 添加搜索结果高亮显示
  - [ ] 实现搜索历史记录（最近5次）
  - [ ] 提供清空搜索和重置功能
- [ ] 实现项目状态筛选功能 (AC: 5)
  - [ ] 创建状态筛选器UI组件
  - [ ] 实现按项目状态（active/completed）筛选逻辑
  - [ ] 支持多状态同时筛选
  - [ ] 保存筛选偏好到localStorage
  - [ ] 显示筛选结果统计信息
- [ ] 整合用户偏好管理系统
  - [ ] 扩展AppSettings数据模型支持排序、折叠、搜索、筛选偏好
  - [ ] 实现用户偏好的持久化存储
  - [ ] 创建偏好重置功能
  - [ ] 确保偏好在应用重启后正确恢复
  - [ ] 优化偏好数据的序列化和反序列化
- [ ] 单元测试 (所有AC)
  - [ ] 拖拽排序功能测试（包含拖拽事件模拟）
  - [ ] 项目折叠展开状态管理测试
  - [ ] 搜索功能和搜索历史测试
  - [ ] 状态筛选器逻辑测试
  - [ ] 用户偏好持久化测试

## Dev Notes

### Previous Story Insights
来自Story 2.1 [Source: docs/stories/2.1.project-create-edit.md]:
- ProjectManager已实现完整的CRUD操作，可以基于此扩展排序功能
- ProjectCard组件已建立基础结构，便于添加拖拽和折叠功能
- StorageManager已具备数据保存和加载功能，可用于存储用户偏好
- React+TypeScript架构已确认，需要使用React hooks和TypeScript类型
- useProjects hook已实现项目数据管理，可扩展支持排序和筛选

来自Story 1.3 [Source: docs/stories/1.3.data-backup-restore.md]:
- AppSettings数据模型已存在，可扩展支持用户偏好设置
- localStorage机制已验证可用，适合存储用户界面偏好

### Data Models
**扩展的Project数据模型** [Source: architecture/data-models.md#Project Model]:
```typescript
interface Project {
  id: string;
  name: string;
  description?: string;
  status: 'active' | 'completed';
  createdAt: Date;
  updatedAt: Date;
  order: number;                 // 用于排序的权重字段
  urls?: ProjectUrl[];
  tags?: string[];
  todos: Todo[];
}
```

**扩展的AppSettings数据模型** [Source: architecture/data-models.md#Application Data Model]:
```typescript
interface AppSettings {
  storagePath?: string;
  theme: 'light' | 'dark' | 'auto';
  autoSave: boolean;
  showCompletedProjects: boolean;
  // 新增用户偏好字段
  projectOrder: {id: string, order: number}[];
  collapsedProjects: string[];   // 折叠的项目ID列表
  searchHistory: string[];       // 搜索历史（最多5条）
  statusFilter: ('active' | 'completed')[];  // 状态筛选偏好
}
```

### API Specifications
**项目排序API** [Source: architecture/api-specification.md#Project API]:
```javascript
// 更新项目排序
ProjectAPI.updateOrder(projectOrders)
// 参数: projectOrders: {id: string, order: number}[]
// 返回: Promise<boolean>
```

**设置管理API** [Source: architecture/api-specification.md#Settings API]:
```javascript
// 更新设置（包含用户偏好）
SettingsAPI.update(settings)
// 参数: settings: Partial<AppSettings>
// 返回: Promise<AppSettings>

// 获取所有设置
SettingsAPI.getAll()
// 返回: Promise<AppSettings>
```

### Component Specifications
**ProjectCard组件扩展** [Source: architecture/components.md#Core Components]:
- 位置：`src/components/ProjectCard.tsx`
- 新增功能：
  - HTML5 Drag & Drop API集成
  - 折叠/展开状态管理
  - 拖拽视觉反馈
  - 搜索结果高亮

**DragDropManager需要实现** [Source: architecture/components.md#DragDropManager]:
- 位置：`src/hooks/useDragDrop.ts`（React Hook形式）
- 主要特性：
  - HTML5 Drag & Drop API封装
  - 项目卡片拖拽排序
  - 跨容器拖拽支持
  - 拖拽状态管理

**新增组件需求**：
- **SearchBar组件**：`src/components/SearchBar.tsx`
  - 实时搜索输入
  - 搜索历史显示
  - 清空和重置功能
- **StatusFilter组件**：`src/components/StatusFilter.tsx`
  - 状态选择器
  - 多选支持
  - 筛选结果统计

### Technical Constraints
**React+TypeScript技术栈** [Source: architecture/tech-stack.md]:
- 使用React Hooks进行状态管理
- TypeScript严格类型检查
- 函数式组件优先

**拖拽实现约束**：
- 使用HTML5 Drag & Drop API [Source: architecture/tech-stack.md#Frontend Technologies]
- 支持Chrome 80+, Firefox 75+, Safari 13+, Edge 80+ [Source: architecture/tech-stack.md#Browser Support]
- 提供键盘操作作为无障碍替代方案

**性能约束**：
- 搜索功能应实时响应，避免阻塞UI
- 拖拽操作应流畅，响应时间<100ms
- 大量项目时排序操作应保持性能

**前端架构** [Source: architecture/frontend-architecture.md]:
- 使用React Hook进行状态管理，避免过度复杂化
- 组件间通信通过props传递和context共享
- 用户偏好通过localStorage持久化

### File Locations
基于实际项目结构：
- **ProjectCard组件**：`src/components/ProjectCard.tsx`（已存在，需扩展）
- **拖拽Hook**：`src/hooks/useDragDrop.ts`（需创建）
- **搜索组件**：`src/components/SearchBar.tsx`（需创建）
- **状态筛选器**：`src/components/StatusFilter.tsx`（需创建）
- **ProjectManager扩展**：`src/managers/ProjectManager.ts`（已存在，需扩展）
- **用户偏好Hook**：`src/hooks/useUserPreferences.ts`（需创建）

### Project Structure Notes
当前项目结构与架构文档的差异：
- 实际使用React+TypeScript架构，而非原生JavaScript
- 组件位于`src/components/`而非`assets/scripts/components/`
- 使用Vite构建工具和现代React生态系统
- 需要遵循现有的React+TypeScript约定和文件组织方式

### Testing
**测试框架** [Source: architecture/testing-strategy.md]:
- 单元测试：Vitest（已配置）+ React Testing Library
- 组件测试：React Testing Library
- 集成测试：Playwright（可选）

**测试标准和要求**：
- 测试拖拽排序功能（使用拖拽事件模拟）
- 测试项目折叠展开状态持久化
- 测试搜索功能和搜索历史记录
- 测试状态筛选器的各种组合
- 测试用户偏好的保存和恢复
- 测试组件在大量项目时的性能表现

**测试文件位置**：
- `src/__tests__/ProjectCard.test.tsx`（已存在，需扩展）
- `src/__tests__/useDragDrop.test.ts`（需创建）
- `src/__tests__/SearchBar.test.tsx`（需创建）
- `src/__tests__/StatusFilter.test.tsx`（需创建）
- `src/__tests__/useUserPreferences.test.ts`（需创建）

**测试数据要求**：
- 创建多个测试项目进行拖拽排序测试
- 准备不同状态的项目进行筛选测试
- 构建搜索关键词和历史记录的测试用例
- 模拟用户偏好数据的序列化测试

**编码规范** [Source: architecture/coding-standards.md]:
- 使用React现代语法和函数式组件
- async/await处理异步操作
- 函数命名：动词开头，描述性（updateProjectOrder, toggleProjectCollapse, searchProjects）
- 错误处理：try-catch包装，用户友好的错误提示
- TypeScript严格类型定义

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-08-10 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
*To be filled by Dev Agent*

### Debug Log References  
*To be filled by Dev Agent*

### Completion Notes List
*To be filled by Dev Agent*

### File List
*To be filled by Dev Agent*

## QA Results
*To be filled by QA agent*